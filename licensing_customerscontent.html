		<!-- BEGIN Record alm_customers -->
<div class="widget-box">
	<div class="widget-header">
		<h3 class="smaller lighter red">{lbname} &nbsp;&nbsp;<span class="icon-phone bigger-130"></span> {lbphone}</h3>
	</div>
	<div class="widget-body">

		<form id="alm_customers" method="post" name="{HTMLFormName}" action="{Action}">
			<div class="row widget-main">
				<!-- BEGIN Error -->
				<div class="alert alert-block alert-danger">
					<button class="close" data-dismiss="alert"><i class="icon-remove"></i></button><strong>
					<li class="icon-remove"></strong>{Error} </li>
				</div>
				<!-- END Error -->
				<div class="row">
					<div class="col-xs-1"></div>
					<div class="col-md-10 col-xs-10">
						<div class="alert alert-block alert-success {page:showalert}">
							<button class="close" data-dismiss="alert"><i class="icon-remove"></i></button> 
							<p><strong><i class="icon-ok"></i>{res:saved}</strong>&nbsp;{res:savedmessage}</p>
						</div>
						<div class="alert alert-block alert-danger {page:showalert_contacterror}">
							<p><strong><i class="icon-warning-sign"></i>{res:contacterror}</strong>&nbsp;{res:contacterrormessage}</p>
						</div>
						<div class="alert alert-block alert-danger {page:showalert_addsupport}">
							<button class="close" data-dismiss="alert"><i class="icon-remove"></i></button>
							<p><strong><i class="icon-warning-sign"></i>{res:addsupport}</strong>&nbsp;{res:addsupportmessage}</p>
						</div>					
					</div>
				</div>
				<!-- row -->
				<div class="tabbable">
					<ul id="myTab" class="nav nav-tabs">
						<li class="{tab1_active}"><a href="#customerdetails" data-toggle="tab">{res:tabcust_title}</a> 
						<li class="{tab2_active}"><a href="#licensingtab" data-toggle="tab">{res:tablicensing_titleadd}</a> </li>
						<li class="{tab3_active}"><a href="#activelicenses" data-toggle="tab">{res:licenses}</a></li>
					 	<li class="{tab4_active}"><a href="#archivedlicenses" data-toggle="tab">{res:archivedlicenses}</a></li>
					 	<li class="{tab5_active}"><a href="#competitor_renewals" data-toggle="tab">{res:competitor_renewals}</a></li>
					 	<li class="{tab6_active}"><a href="#product_displacement" data-toggle="tab">{res:product_displacement}</a></li>
					 	<li class="{tab7_active}"><a href="#expired_licenses" data-toggle="tab">{res:expired_licenses}</a></li>
					 	<li class="{tab8_active}"><a href="#perpetual_licenses" data-toggle="tab">{res:perpetual_licenses}</a></li>
					</ul>
					<div class="tab-content col-md-12 col-xs-12">
						<div id="customerdetails" class="tab-pane {tab1_active}">
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-5 col-xs-12">
									<label for="s_customer" class="control-label blue">{res:customer}</label><br>
									<input type="text" disabled id="s_customer" class="col-md-12 col-xs-12" maxlength="250" value="{name}" name="{name_Name}" data-validation="required" data-validation-error-msg="{res:invalidcustomer}">
								</div>
								<!-- col -->
								<div class="col-md-2 col-xs-12">
									<label for="s_customer" class="control-label blue">{res:taxid}</label><br>
									<input type="text" disabled id="s_taxid" class="col-md-12 col-xs-12" maxlength="20" value="{taxid}" name="{taxid_Name}">
								</div>
								<div class="col-md-2 col-xs-12">
									<label for="s_type" class="control-label blue">{res:customertype}</label><br>
									<select disabled id="s_type" class="col-md-12 col-xs-12" name="{customertype_id_Name}">
										<option selected value="">{res:CCS_SelectValue}</option>
										{customertype_id_Options}
									</select>
 
								</div>
							</div>
							<!-- row-->
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-5 col-xs-12">
									<label for="s_phone" class="control-label blue">{res:phone}</label><br>
									<input type="text" disabled id="s_phone" class="col-md-12 col-xs-12" maxlength="200" value="{phone}" name="{phone_Name}">
								</div>
								<div class="col-md-5 col-xs-12">
									<label for="s_website" class="control-label blue">{res:website}</label><br>
									<input type="text" disabled id="s_website" class="col-md-12 col-xs-12" maxlength="250" value="{website}" name="{website_Name}">
								</div>
							</div>
							<!-- row -->
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-5 col-xs-12">
									<label for="s_phone" class="control-label blue">{res:address}</label><br>
									<textarea disabled id="s_address" class="col-md-12 col-xs-12" rows="3" cols="49" name="{address_Name}">{address}</textarea>
								</div>
								<div class="col-md-3 col-xs-12">
									<label for="city" class="control-label blue">{res:city}</label><br>
									<select disabled id="city" class="col-md-12 col-xs-12" name="{city_Name}">
										{city_Options}
									</select>
 
								</div>
								<div class="col-md-3 col-xs-12">
									<label for="businesspartner" class="control-label blue">{res:businesspartners}</label><br>
									<label>
									<!-- BEGIN CheckBoxList businesspartner --><input disabled id="businesspartner_{businesspartner:optionNumber}" class="ace ace-checkbox-2" type="checkbox" value="{Value}" name="{businesspartner_Name}" {Check}><span class="lbl">&nbsp;&nbsp;{Description}</span><br>
									<!-- END CheckBoxList businesspartner --></label>
								</div>
							</div>
							<!-- row -->
							<div class="row col-xs-12">
								<div class="col-md-1 col-md-0">
								</div>
								<div class="col-md-10 col-xs-12">
									<h3 class="header smaller lighter red"><span class="icon-phone bigger-130">&nbsp;</span>&nbsp;{res:contacts}</h3>
									<div class="table-responsive">
										<table class="table table-striped table-bordered table-hover">
											<tr>
												<th class="blue text-center"><span class="icon-cogs bigger-150">&nbsp;</span></th>
 
												<th class="blue">{res:contact}</th>
 
												<th class="blue">{res:contact_jobposition}</th>
 
												<th class="blue">{res:phone}</th>
 
												<th class="blue">{res:extension}</th>
 
												<th class="blue">{res:mobile}</th>
 
												<th class="blue">{res:workemail}</th>
 
												<th class="blue">{res:personalemail}</th>
 
												<th class="blue">{res:dateupdated}</th>
											</tr>
											<!-- BEGIN contact_list -->
											<tr>
												<td nowrap>
													<div class="action-buttons">
													</div>
												</td> 
												<td><span class="icon-asterisk bigger-120 orange {lbmaincontact}">&nbsp;</span>&nbsp;{lbcontact}</td> 
												<td>{lbcontact_jobposition}</td> 
												<td>{lbcontact_phone}</td> 
												<td>{lbcontact_extension}</td> 
												<td>{lbcontact_mobile}</td> 
												<td>{lbcontact_workemail}</td> 
												<td>{lbcontact_personalemail}</td> 
												<td nowrap>{lbcontact_dateupdated}</td>
											</tr>
											<!-- END contact_list -->
										</table>
									</div>
								</div>
							</div>
							<!-- row -->
						</div>
					</form>
					<!-- END Record alm_customers -->
					<!-- customerdetails tab -->
					<div id="licensingtab" class="tab-pane {tab2_active}">
						<!-- BEGIN Record licensing -->
						<form id="licensing" method="post" name="{HTMLFormName}" action="{Action}">
							<!-- BEGIN Error -->
								<div class="row">
									<div class="col-xs-1"></div>
									<div class="col-md-10 col-xs-10">
										<div class="alert alert-block alert-danger">
											<button class="close" data-dismiss="alert"><i class="icon-remove"></i></button>
											<strong>{res:error}</strong>&nbsp;{Error} </li>
										</div>
									</div>
								</div>
							 <!-- END Error -->
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:manufacturer}</label><br>
									<select id="manufacturer" class="width-90 chosen-select" name="{manufacturer_Name}">
										<option selected value="">{res:selectoption}</option>
										{manufacturer_Options}
									</select>
 
								</div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:suite_code}</label><br>
									<select id="suite" class="width-90 chosen-select licensefilter" name="{suite_code_Name}" data-validation="required" data-validation-error-msg="{res:invalidsuite}">
										<option selected value="">{res:selectoption}</option>
										
{suite_code_Options}
									</select>
								</div>
								<div class="col-md-3 col-xs-12">
									<label class="control-label blue">{res:product_type}</label><br>
									<select name="{id_product_type_Name}" id="id_product_type" class="width-90 chosen-select licensefilter">
										<option value="">{res:selectoption}</option>
										{id_product_type_Options}
									</select>
								</div>

							</div><!-- row -->

							<div class="row col-xs-12 space"></div>

							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0"></div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:licensesector}</label><br>
									<select id="id_license_sector" class="width-90 chosen-select licensefilter" name="{id_license_sector_Name}">
										<option selected value="0">{res:selectoption}</option>
										{id_license_sector_Options}
									</select>
								</div>

								<div class="col-md-3 col-xs-12">
									<label class="control-label blue">{res:licensetype}</label><br>
									<select id="id_license_type" class="width-90 chosen-select licensefilter" name="{id_license_type_Name}">
										<option selected value="0">{res:selectoption}</option>
										{id_license_type_Options}
									</select>
								</div>

								<div class="col-md-2 col-xs-12">
									<div class="row col-xs-10">
										<label class="control-label blue">{res:channel_sku}</label><br>
										<input type="text" id="channel_sku" class="col-md-12 col-xs-12 searchsku" value="{channel_sku}" name="{channel_sku_Name}" data-validation="required" data-validation-error-msg="{res:invalidsku}">
									</div>
								</div>

							</div><!-- row -->

							<div class="row col-xs-12 space"></div>

							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-6 col-xs-12">
									<label class="control-label blue">{res:suite}</label><br>
									<input type="text" disabled id="suitedescription" class="col-md-12 col-xs-12" value="{suitedescription}" name="{suitedescription_Name}">								
								</div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:msrp_price}</label><br>
									<input type="text" id="msrp_price" class="col-md-12 col-xs-12" value="{msrp_price}" name="{msrp_price_Name}">
								</div>
							</div><!-- row -->

							<div class="row col-xs-12 space"></div>

							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0"></div>
								<div class="col-md-9 col-xs-12">
									<label class="control-label blue">{res:product}</label><br>
									<select id="products" class="width-90 chosen-select" name="{id_product_Name}" data-validation="required" data-validation-error-msg="{res:invalidproduct}">
										<option selected value="">{res:selectoption}</option>
										{id_product_Options}
									</select>
 
								</div>
							</div><!-- row -->

							<div class="row col-xs-12 space"></div>

							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0"></div>
								<div class="col-md-4 col-xs-12">
									<label class="control-label blue">{res:reseller}</label><br>
									<select id="reseller" class="width-90 chosen-select" name="{id_reseller_Name}">
										<option selected value="">{res:selectoption}</option>
										{id_reseller_Options}
									</select>
								</div>

								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:registeredon}</label><br>
									<div class="input-group">
										<input type="text" class="col-md-12 col-xs-12 date-picker" value="{registered_date}" name="{registered_date_Name}" data-date-format="M/dd/yyyy">
										<span class="input-group-addon"><i class="icon-calendar bigger-110"></i></span>
									</div>
								</div>

								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:licensestatus}</label><br>
									<span class="{lblicense_status_css}">{id_license_status}</span>
								</div>

							</div>
							<!-- row -->
							<div class="row col-xs-12 space">
							</div>
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0"></div>
								<div class="col-md-4 col-xs-12">
									<label class="control-label blue">{res:licensedby}</label><br>
									<!-- BEGIN RadioButton id_licensed_by --><input id="id_licensed_by_{Value}" class="ace id_licensed_by" type="radio" value="{Value}" name="{id_licensed_by_Name}" {Check}><span class="lbl">&nbsp;&nbsp;{Description}&nbsp;&nbsp;&nbsp;</span><!-- END RadioButton id_licensed_by -->
								</div>
								<div id="amounts" class="col-md-2 col-xs-12 hide">
									<label class="control-label blue">{res:amount_percentage}</label><br>
									<input type="text" id="licensed_amount" class="col-md-12 col-xs-12" value="{licensed_amount}" name="{licensed_amount_Name}" data-validation="number" data-validation-error-msg="{res:invalidamount}" data-validation-optional="true">
								</div>
								<div id="nodes" class="col-md-2 col-xs-12">
									<div class="row col-xs-12">
										<label class="control-label blue">{res:numberofnodes}</label><br>
										<input type="text" id="licensed_nodes" class="col-md-12 col-xs-12" value="{nodes}" name="{nodes_Name}" data-validation="number" data-validation-error-msg="{res:invalidnodes}" data-validation-optional="true">
									</div>
								</div>

								<div class="col-md-2 col-xs-12">
									<div class="row col-xs-12">
										<label class="control-label blue">{res:totalcost}</label><br>
										<input type="text" id="totalcost" class="col-md-12 col-xs-12" name="{totalcost_Name}" value="{totalcost}" readonly>
									</div>
								</div>

							</div><!-- row -->
							
							<div class="row col-xs-12 space"></div>

							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-4 col-xs-12">
									<div class="row col-xs-12">
										<div class="col-md-12 col-xs-12">
											<select name="{granttype_Name}" id="license_granttype" class="width-90 chosen-select" disabled>
												{granttype_Options}
											</select><input type="hidden" name="{hidGrantType_Name}" value="{hidGrantType}" id="hidGrantType"><br>
											<input type="text" class="col-md-11 col-xs-12" value="{grant_number}" name="{grant_number_Name}">
										</div>
									</div>
								</div>

								<div class="col-md-2 col-xs-12">
									<div class="row col-xs-12">
										<label class="control-label blue">{res:expeditiondate}</label><br>
										<div class="input-group">
											<input type="text" class="col-md-12 col-xs-12 date-picker" value="{expedition_date}" name="{expedition_date_Name}" data-date-format="M dd, yyyy" id="expeditionDate">
											<span class="input-group-addon"><i class="icon-calendar bigger-110"></i></span>
										</div>
									</div>
								</div>
								<div class="col-md-2 col-xs-12">
									<div class="row col-xs-12">
										<label class="control-label blue">{res:expirationdate}</label><br>
										<div class="input-group">
											<input type="text" class="col-md-12 col-xs-12 date-picker" value="{expiration_date}" name="{expiration_date_Name}" data-date-format="M dd, yyyy" id="expirationDate" {expirationDisabled}>
											<span class="input-group-addon"><i class="icon-calendar bigger-110"></i></span>
										</div>
									</div>
								</div>
								<div class="col-md-2 col-xs-12">
									<div class="row col-xs-12">
										<label class="control-label blue">{res:serialnumber}</label><br>
										<input type="text" class="col-md-12 col-xs-12" value="{serial_number}" name="{serial_number_Name}">
									</div>
								</div>
							</div><!-- row -->

							<div class="row col-xs-12 space"></div>

							<!-- BEGIN Panel pnrenewcompetitor -->
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-1"></div>
								<div class="col-md-12 col-xs-12">
									<div class="alert alert-warning">{res:renewcompetitor}</div>
								</div>
							</div>
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0"></div>
								<div class="col-md-4 col-xs-12">
									<label class="control-label blue">{res:competitor}</label><br>
									<select name="{renew_businesspartner_id_Name}" id="businessPartner" class="width-90 chosen-select">
										<option selected value="">{res:selectoption}</option>
										{renew_businesspartner_id_Options}
									</select>
								</div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:renewcompetitor_date}</label><br>
									<div class="input-group">
										<input type="text" class="col-md-12 col-xs-12 date-picker" value="{renew_businesspartner_date}" name="{renew_businesspartner_date_Name}" data-date-format="M dd, yyyy" id="expirationDateCompetitor" {expirationDisabled}>
										<span class="input-group-addon"><i class="icon-calendar bigger-110"></i></span>
									</div>
								</div>
							</div>
							<!-- END Panel pnrenewcompetitor -->
							
							<!-- BEGIN Panel pnproduct_displacement -->
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-1"></div>
								<div class="col-md-12 col-xs-12">
									<div class="alert alert-warning">{res:product_displacement_license}</div>
								</div>
							</div>
							<div class="row col-xs-12">
								<div class="col-md-1 col-xs-0">
								</div>
								<div class="col-md-4 col-xs-12">
									<label class="control-label blue">{res:competitor_product}</label><br>
									<select name="{competitor_product_Name}" id="productCompetitor" class="width-90 chosen-select">
										<option selected value="">{res:selectoption}</option>
										{competitor_product_Options}
									</select>
								</div>
								<div class="col-md-2 col-xs-12">
									<label class="control-label blue">{res:renewcompetitor_date}</label><br>
									<div class="input-group">
										<input type="text" class="col-md-12 col-xs-12 date-picker" value="{competitor_date}" name="{competitor_date_Name}" data-date-format="M dd, yyyy" id="competitorDate" {expirationDisabled}><span class="input-group-addon"><i class="icon-calendar bigger-110"></i></span>
									</div>
								</div>
							</div>
							<!-- END Panel pnproduct_displacement -->

							<div class="row col-xs-12 space hr"></div>

							<div class="row">
								<div class="col-md-12 col-xs-12">
									<div class="form-actions action-buttons center inline col-xs-12">
										<div class="inline"><a href="licensing.php{lbgoback}" role="button" id="goback" class="btn btn-sm btn-success"><li class="icon-arrow-left"></li>&nbsp;{res:buttongoback}</a> &nbsp;&nbsp;</div>
										<div class="inline">
											<!-- BEGIN Button Button_Insert --><button class="btn btn-sm btn-success" type="submit" name="{Button_Name}" value="{res:buttonsave}"><li class="icon-save"></li>&nbsp; {res:buttonsave}</button><!-- END Button Button_Insert -->
										</div>
										<div class="inline">
											<!-- BEGIN Button Button_Update --><button class="btn btn-sm btn-success" type="submit" name="{Button_Name}" value="{res:buttonsave}"><li class="icon-save"></li>&nbsp; {res:buttonsave}</button><!-- END Button Button_Update -->
										</div>
										<div class="inline">
											<!-- BEGIN Panel pnaddsupport -->&nbsp;&nbsp;
												<a href="licensing_customers.php?o=addsupport{params1}" role="button" id="addsuport" class="btn btn-sm btn-warning"><li class="icon-copy"></li>&nbsp;{res:addsupport}</a>
											<!-- END Panel pnaddsupport -->
										</div>
										<div class="inline">											
											<!-- BEGIN Panel pncanceledit -->&nbsp;&nbsp;
												<a href="licensing_customers.php?{params}" role="button" id="canceledit" class="btn btn-sm btn-yellow"><li class="icon-ban-circle"></li>&nbsp;{res:canceledit}</a>
											<!-- END Panel pncanceledit -->
										</div>

										<input type="hidden" value="{modified_iduser}" name="{modified_iduser_Name}">
										<input type="hidden" value="{created_iduser}" name="{created_iduser_Name}">
										<input type="hidden" value="{hidguid}" name="{hidguid_Name}">
										<input type="hidden" value="{hidtab}" name="{hidtab_Name}">
										<input type="hidden" value="{hidcustomer_guid}" name="{hidcustomer_guid_Name}">
										<input type="hidden" value="{hidcustomer_id}" name="{hidcustomer_id_Name}">
										<input type="hidden" name="{hidlicensestatus_Name}" value="{hidlicensestatus}">
										<input type="hidden" name="{hido_Name}" value="{hido}">
										<input type="hidden" name="{hiddguid_Name}" value="{hiddguid}">
										<input type="hidden" name="{hidexpired_license_guid_Name}" value="{hidexpired_license_guid}">
										<input type="hidden" name="{hidparent_license_guid_Name}" value="{hidparent_license_guid}">
									</div>
								</div>
								<!-- col -->
							</div><!-- row -->
				</form>
				<!-- END Record licensing -->

							<!-- license drop zone here -->
							<div class="row">
								<div class="col-md-5 col-xs-12">
									<!-- BEGIN Panel pndropzone -->
									<form class="dropzone" name="dropzone" action="licensing_customers.php" method="post">
										<label for="title" class="blue">{res:uploadlicense}</label>
										<input type="hidden" name="{hidlicense_guid_Name}" value="{hidlicense_guid}" id="hidlicense_guid">
										<div class="fallback">
											<input type="file" id="licensefile" multiple />
										</div>
									</form>
									<!-- END Panel pndropzone -->
								</div>
								<div class="col-md-5 col-xs-12">
									<!-- BEGIN licensefile_list -->
									<div class="inline col-xs-2">
										<div class="row action-buttons">
											<a href="licensing_viewfile.php?licensefile_guid={licensefile_guid}{getparams}"><img src="assets/license64.png" class="img-responsive img-rounded" /></a>
										</div>
										<div class="row action-buttons inline">
											<a href="licensing_viewfile.php?licensefile_guid={licensefile_guid}{getparams}"><li class="icon-eye-open bigger-180 blue"></li></a>
											{linkdelete}											
										</div>
									</div>
									<!-- END licensefile_list -->
								</div>
							</div> <!-- row -->

						</div>
						<!-- licensing tab -->

						<div id="activelicenses" class="tab-pane {tab3_active}">
							{licensing_activelicense_tab}
						</div><!-- tab-pane activelicenses -->

						<div id="archivedlicenses" class="tab-pane {tab4_active}">
							{licensing_archived_tab}
						</div><!-- archivedlicenses -->
						
						<div id="competitor_renewals" class="tab-pane {tab5_active}">
							{licensing_competitor_renewals}
						</div><!-- competitor_renewals -->

						<div id="product_displacement" class="tab-pane {tab6_active}">
							{licensing_product_displacement}
						</div>

						<div id="expired_licenses" class="tab-pane {tab7_active}">
							{licensing_expired_licenses}
						</div>
						<div id="perpetual_licenses" class="tab-pane {tab8_active}">
							{licensing_perpetual_licenses}
						</div>
					</div>
					<!-- tabcontent -->
				</div>
				<!-- tabbable -->
			</div>
			<!-- row -->
	</div>
	<!-- widget-body -->
</div>
<!-- widget-box -->

<!-- fixed style for popup box table to cover the whole table -->
<style>
	.popover {
		max-width: 100%
	}
</style>

<link rel="stylesheet" href="assets/css/datepicker.css">
<link rel="stylesheet" href="assets/css/colorbox.css">
<link rel="stylesheet" href="assets/css/chosen.css">
<link rel="stylesheet" href="assets/css/dropzone.css" />
<!-- included here to not mess with too much js in the main page -->
<script src="assets/js/jquery-2.0.3.min.js"></script>
<script src="assets/js/json3.min.js"></script>
<script src="assets/js/form-validator/jquery.form-validator.min.js"></script>
<script src="assets/js/jquery.colorbox-min.js"></script>
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="assets/js/bootbox.min.js"></script>
<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/jquery.colorbox-min.js"></script>
<script src="assets/js/chosen.jquery.min.js"></script>
<script src="assets/js/dropzone.min.js"></script>
<script src="assets/js/jquery.dataTables.min.js"></script>
<script src="assets/js/jquery.dataTables.bootstrap.js"></script>



<script>
$(function(){
    	    
	    $.validate({
	         form : "#licensing"
	    });


		//Preparing table responsive
		var oTable1 = $("#activelicenses_table").dataTable( {
			"aoColumns": [
	      		//{ "bSortable": false },
	      		null, null,null,null, null,null,null, null,null
			],
			"bAutoWidth" : true
		});

        //Specified the width, for some weird reason, the width-90 class wasnt working
        $(".chosen-select").chosen({width: "90%"}); 

        $(".date-picker").datepicker({
			orientation: "bottom auto",
			autoclose:true,
			todayHighlight: true,
			format: 'M dd, yyyy',
        });


		$("#expeditionDate").change(function() {
			var expDate = $(this).val();
			if (expDate.length > 0) {
				var expireDate = new Date(expDate); 
				expireDate.setFullYear(expireDate.getFullYear() +  1);
				expireDate.setDate(expireDate.getDate() - 1);			
				var day = expireDate.getDate();
				if (day < 10)
					day = "0" + day;

				var month = expireDate.getMonth() + 1;
				//if (month < 10)
				//	month = "0" + month;

				var year = expireDate.getFullYear();
				var fullExpireDate = month + "/" + day + "/" + year;
				var isoExpireDate = new Date(fullExpireDate);
				var options = {year: 'numeric', month: 'short', day: '2-digit' };
				console.log(fullExpireDate);
				console.log(isoExpireDate.toLocaleDateString('en-US', options));
				//$("#expirationDate").val(fullExpireDate);
				$("#expirationDate").val(isoExpireDate.toLocaleDateString('en-US', options));

				//Checking the licenseType listbox
				var licenseType = $("#id_license_type").val();
				if ( (licenseType == 7) || (licenseType == 12) ) {
					$("#expirationDate").val("");
					$("#expirationDate").prop("disabled","disabled");
				} else {
					$("#expirationDate").prop("disabled","");						
				}

			} else {				
				$("#expirationDate").val("");
			}

		});


        //Default value for radio
        var selectedLicensedBy = $("input[name=id_licensed_by]:checked").val();
        if (selectedLicensedBy == 1) {
                $("#nodes").removeClass("hide");
                $("#amounts").addClass("hide"); 
        } else {
                $("#nodes").addClass("hide");
                $("#amounts").removeClass("hide");      
        }

        $(".id_licensed_by").change(function() {
                var selected = $(this).val();
                if (selected == 1) {
                        $("#nodes").removeClass("hide");
                        $("#amounts").addClass("hide");
                } else {
                        $("#nodes").addClass("hide");
                        $("#amounts").removeClass("hide");
                }
        });
		
		//search sku executes for both botton and channelsku input
		$(".searchsku").on("click keyup",function() {
			var sku = $("#channel_sku").val();
			if (sku.length > 0) {
				var params = {m: "product_info_sku", channel_sku: sku};
				$.ajax({
					url: "ajaxget.php",
					type: "get",
					data: params
				}).done(function(msg) {
					var manufacturer = $("#manufacturer");
					var suite = $("#suite");
					var id_product_type = $("#id_product_type");
					var id_license_sector = $("#id_license_sector");
					var id_license_type = $("#id_license_type");
					var suitedescription = $("#suitedescription");
					var msrp_price = $("#msrp_price");
					var license_granttype = $("#license_granttype");

					//If product object is empty set 0 to all lisbox and values autofilled
					if (msg.products.length <= 0) {
						manufacturer.val(0);
						manufacturer.trigger("chosen:updated");
						suite.val(0);
						suite.trigger("chosen:updated");
						id_product_type.val(0);
						id_product_type.trigger("chosen:updated");
						id_license_sector.val(0);
						id_license_sector.trigger("chosen:updated");
						id_license_type.val(0);
						id_license_type.trigger("chosen:updated");
						suitedescription.val("");
						license_granttype.val(1);
						license_granttype.trigger("chosen:updated");
						$("#hidGrantType").val(license_granttype.val());

                        $("#id_licensed_by_1").click();      
                        $("#licensed_amount").val(0);
                        $("#msrp_price").val(0);
                        $("#products").empty();
                        $("#products").trigger("chosen:updated");

						//Checking the licenseType listbox
						var licenseType = $("#id_license_type").val();
						if ( (licenseType == 7) || (licenseType == 12) ) {
							$("#expirationDate").val("");
							$("#expirationDate").prop("disabled","disabled");
						} else {
							$("#expirationDate").prop("disabled","");						
						}

					}

					$.each(msg.products, function() {
						var curManufacturer = this.id_manufacturer;
						curManufacturer = curManufacturer || 0;
						manufacturer.val(curManufacturer);
						manufacturer.trigger("chosen:updated");

						var curSuite = this.id_suite;
						curSuite = curSuite || 0;
						suite.val(curSuite);
						suite.trigger("chosen:updated");

						//convert to 0 in case of null or undefined value
						var productType = this.id_product_type;
						productType = productType || 0;
						id_product_type.val(productType);
						id_product_type.trigger("chosen:updated");

						//convert to 0 in case of null or undefined value
						var licenseSector = this.id_license_sector;
						licenseSector = licenseSector || 0;
						id_license_sector.val(licenseSector);
						id_license_sector.trigger("chosen:updated");
						
						var licenseType = this.id_license_type;
						licenseType = licenseType || 0;
						id_license_type.val(licenseType);
						id_license_type.trigger("chosen:updated");

						var licenseGrantType = this.id_license_granttype;
						licenseGrantType = licenseGrantType || 1;
						license_granttype.val(licenseGrantType);
						license_granttype.trigger("chosen:updated");
						$("#hidGrantType").val(licenseGrantType);

						//Checking the licenseType listbox
						if ( (licenseType == 7) || (licenseType == 12) ) {
							$("#expirationDate").val("");
							$("#expirationDate").prop("disabled","disabled");
						} else {
							$("#expirationDate").prop("disabled","");						
						}

						suitedescription.val(this.suite_description);
                        $("#id_licensed_by_"+this.id_licensed_by).click();      
                        $("#licensed_amount").val(this.licensed_amount);
						var productPrice = parseFloat(this.msrp_price);
                        $("#msrp_price").val(productPrice.toFixed(2));

						//Making the math for total costs
						var licenseBy = this.id_licensed_by || 0;
						var msrpPrice = Number(productPrice.toFixed(2));
						setTotalCost(licenseBy,msrpPrice);

						//Refilling product listbox based on sku search
                        var products = $("#products");
                        products.empty();
                        products.trigger("chosen:updated");
                        products.append($("<option/>").val("").text("{res:selectoption}") );
						products.append( $("<option/>").val(this.id).text(this.description +" ( {res:nodes}: "+ this.range_min +" - "+ this.range_max +" ) ").prop("selected",true) );
                        products.trigger("chosen:updated");

					});
				
				});
			}
		});


        $(".licensefilter").change(function() {
                var suite_id = $("#suite").val();
				var id_product_type = $("#id_product_type").val();
				var id_license_sector = $("#id_license_sector").val();
				var id_license_type = $("#id_license_type").val();

                var params = {m: "suite_description",id: suite_id};
                $.ajax({
                        url: "ajaxget.php",
                        type: "get",
                        data: params
                }).done(function(msg) {
                        $("#suitedescription").val(msg.suite_description);
                        //$("#product_content").val(msg.suite_long_description);
                });

                var params = {m: "product_info",id: suite_id, id_product_type: id_product_type, 
							id_license_sector: id_license_sector, id_license_type: id_license_type};
                $.ajax({
                        url: "ajaxget.php",
                        type: "get",
                        data: params
                }).done(function(msg) {
                        var products = $("#products");
                        products.empty();
                        products.trigger("chosen:updated");
                        products.append($("<option/>").val("").text("{res:selectoption}") );
                        $.each(msg.products, function() {
                                products.append( $("<option/>").val(this.id).text(this.description +" ( {res:nodes}: "+ this.range_min +" - "+ this.range_max +" ) ") );
                        });
                        products.trigger("chosen:updated");
                });


        });


        $("#products").change(function() {
                var product_id = $(this).val();
                var params = {m: "product_detail",id: product_id};
                $.ajax({
                        url: "ajaxget.php",
                        type: "get",
                        data: params
                }).done(function(msg) {
                        $.each(msg.products, function() {
                                $("#id_license_sector").val(this.id_license_sector);
                                $("#id_license_sector").trigger("chosen:updated");

                                $("#id_product_type").val(this.id_product_type);
                                $("#id_product_type").trigger("chosen:updated");

                                $("#id_license_type").val(this.id_license_type);
                                $("#id_license_type").trigger("chosen:updated");

                                $("#id_licensed_by_"+this.id_licensed_by).click();      
                                $("#licensed_amount").val(this.licensed_amount);
                                $("#channel_sku").val(this.channel_sku);
								var productPrice = parseFloat(this.msrp_price);
                                $("#msrp_price").val(productPrice.toFixed(2));

								//Making the math for total costs
								var licenseBy = this.id_licensed_by || 0;
								var msrpPrice = Number(productPrice.toFixed(2));
								setTotalCost(licenseBy,msrpPrice);

								$("#license_granttype").val(this.id_license_granttype);
								$("#license_granttype").trigger("chosen:updated");
								$("#hidGrantType").val(this.id_license_granttype);
                        });

                });
        });

		//Sets the total cost of license based on nodes, quatity or percentage
		function setTotalCost(licenseBy, msrpPrice) {
			switch (licenseBy) {
				case "1" :
					var licensedNodes = $("#licensed_nodes").val();
					licensedNodes = licensedNodes || 0;
					var totalCost = (msrpPrice * licensedNodes);
					totalCost = parseFloat(totalCost);
					totalCost = totalCost.toFixed(2);
					$("#totalcost").val(totalCost);
				break;
				case "2" :
					var licensedAmount = $("#licensed_amount").val();
					licensedAmount = licensedAmount || 0;
					var totalCost = (msrpPrice * licensedAmount)
					totalCost = parseFloat(totalCost);
					totalCost = totalCost.toFixed(2);
					$("#totalcost").val(totalCost);	
				break;
				case "3" :
					var licensedAmount = $("#licensed_amount").val();
					licensedAmount = licensedAmount || 0;
					var totalCost = ( msrpPrice + (msrpPrice * (licensedAmount/100)) );
					totalCost = parseFloat(totalCost);
					totalCost = totalCost.toFixed(2);
					$("#totalcost").val(totalCost);	
				break;
			}

		}

        $("#manufacturer").chosen().change(function() {
                var manufacturer_id = $(this).val();
                var params = {m: "suite_manufacturer",id: manufacturer_id};
                $.ajax({
                        url: "ajaxget.php",
                        type: "get",
                        data: params
                }).done(function(msg) {
                        var suite = $("#suite");
                        suite.empty();
                        suite.trigger("chosen:updated");
                        suite.append($("<option/>").val("0").text("{res:selectoption}"));
                        $.each(msg.suite, function() {
                                suite.append($("<option/>").val(this.id).text(this.suite_code));
                        });
                        suite.trigger("chosen:updated");

                });
        });

		//Disables the expirationDate if licenseType is perpetual
		$("#id_license_type").chosen().change(function() {
			var licenseType = $(this).val();
			if ( (licenseType == 7) || (licenseType == 12) ) {
				$("#expirationDate").prop("disabled","disabled");
			} else {
				$("#expirationDate").prop("disabled","");		
			}
		});


        $(".dellicense").click(function(e) {
            var link = $(this).attr("href");
            e.preventDefault();    
            bootbox.confirm("{res:confirmdelete}", function(result) {
            	if (result) {
                	window.location.replace(link);
                } 
            });

         });

		//Related licenses popover
		$("[data-rel=popover]").popover();
		
		//Using events on popovers, strangely only the first element was firing it
		//var popover = $("[data-rel=popover]").popover();
		//popover.on("show.bs.popover", function() {
		//	popover.data()["bs.popover"].$tip.css("max-width", "90%");
		//});

	
	//Inside a panel because when dropzone element is not present throws an error and mess js scripts in menus
	<!-- BEGIN Panel pndropzonejs -->
		Dropzone.autoDiscover = false;
		var dropzone = new Dropzone(".dropzone", { 
			maxFilesize: 10, 
			//forceFallback: false,
			//clickable: false,
			//in MB acceptedFiles: "application/pdf,.pdf", 
			dictDefaultMessage: "{res:dropimagestitle}" 
		});
		dropzone.on("success", function(file) {
			//Refresh page after upload
			location.reload();
		});
	<!-- END Panel pndropzonejs -->


	<!-- Disabling granttype using readonly attr -->
	
});

</script>
